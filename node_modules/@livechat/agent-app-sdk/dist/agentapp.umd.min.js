((n,e)=>{"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n=n||self).LiveChat={})})(this,function(e){function n(){return(n=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t,r=arguments[e];for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n}).apply(this,arguments)}var r=function(r){return r=r||Object.create(null),{on:function(n,e){(r[n]||(r[n]=[])).push(e)},off:function(n,e){r[n]&&r[n].splice(r[n].indexOf(e)>>>0,1)},emit:function(e,t){(r[e]||[]).slice().map(function(n){n(t)}),(r["*"]||[]).slice().map(function(n){n(e,t)})}}},d=function(){var t=Object.create(null),i=r(t);return n({},i,{off:function(n,e){n?i.off(n,e):Object.keys(t).forEach(function(n){delete t[n]})},once:function(r,o){i.on(r,function n(e,t){i.off(r,n),o(e,t)})}})},t={}.hasOwnProperty;function a(n,e){return t.call(e,n)}function o(){}function B(n){var e,t=!1;return function(){return t?e:(t=!0,e=n.apply(void 0,arguments))}}function p(){return(p=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t,r=arguments[e];for(t in r)!{}.hasOwnProperty.call(r,t)||(n[t]=r[t])}return n}).apply(null,arguments)}var D=function(e){return new Promise(function(n){n(e())})},i=function(r){return function(e){return function(n,t){0===n&&e(0,function(n,e){t(n,1===n?r(e):e)})}}};var Y=function(u){return void 0===u&&(u={}),function(n){var t,e=u="function"==typeof u?{next:u}:u,r=e.next,o=e.error,i=e.complete;n(0,function(n,e){0===n&&(t=e),1===n&&r&&r(e),1!==n&&0!==n||t(1),2===n&&!e&&i&&i(),2===n&&e&&o&&o(e)});return function(){t&&t(2)}}};function c(t){return new Promise(function(n,e){var a;Y({next:n,error:e,complete:function(){var n=new Error("No elements in sequence.");n.code="NO_ELEMENTS",e(n)}})((a=t,function(n,t){var r,o,i,u;0===n&&(o=r=!1,a(0,function(n,e){0===n?(i=e,t(0,function(n,e){2===n&&(o=!0),i(n,e)})):1===n?(r=!0,u=e,i(1)):2===n&&!e&&r&&(t(1,u),o)||t(n,e)}))}))})}var g=function(o){return function(e){return function(n,t){var r;0===n&&e(0,function(n,e){0===n?t(n,r=e):1!==n||o(e)?t(n,e):r(1)})}}},W=function(r){return function(n){var t;n(0,function(n,e){0===n&&(t=e),1===n&&r(e),1!==n&&0!==n||t(1)})}},u=function(e){var c,s=[];return function(n,u){var a;0===n&&(s.push(u),a=function(n,e){var t;2===n?(-1<(t=s.indexOf(u))&&s.splice(t,1),s.length||c(2)):c(n,e)},1===s.length?e(0,function(n,e){if(0===n)c=e,u(0,a);else for(var t,r=s.slice(0),o=Array.isArray(r),i=0,r=o?r:r[Symbol.iterator]();;){if(o){if(i>=r.length)break;t=r[i++]}else{if((i=r.next()).done)break;t=i.value}t(n,e)}2===n&&(s=[])}):u(0,a))}},s=function(u){return function(e){return function(n,t){var r,o;function i(n,e){r<u&&o(n,e)}0===n&&e(r=0,function(n,e){0===n?(o=e,t(0,i)):1===n?r<u&&(r++,t(n,e),r===u)&&(t(2),o(2)):t(n,e)})}}};var f="call",l="emit",v="@@livechat/postmessenger",F="handshake",h="response",m=function(e){return function(n,r){var o,i,u;function a(n,e){1===n&&(u||i)(1,e),2===n&&(u&&u(2),i(2))}0===n&&(o=!1,e(0,function(n,e){var t;0===n?(i=e,r(0,a)):1===n?(t=e,u&&u(2),t(0,function(n,e){0===n?(u=e)(1):1===n?r(1,e):2===n&&e?(i(2),r(2,e)):2===n&&(o?r(2):(u=void 0,i(1)))})):2===n&&e?(u&&u(2),r(2,e)):2===n&&(u?o=!0:r(2))}))}},I=function(r){return function(n,e){var t;0===n&&(t=!1,e(0,function(n){2===n&&(t=!0)}),e(1,r()),t||e(2))}},N=function(n){return m(I(n))},y=function(r){return function(n,e){var t;0===n&&(t=!1,e(0,function(n){2===n&&(t=!0)}),e(1,r()),t||e(2))}};function w(r){return function(n,e){var t;0!==n||(t=!1,e(0,function(n){2===n&&(t=!0)}),t)||e(2,r||new Error)}}var _=function(o,i,u){return function(n,e){var t,r;0!==n||(t=!1,r=function(n){e(1,n)},e(0,function(n){2===n&&(t=!0,o.removeEventListener(i,r,u))}),t)||o.addEventListener(i,r,u)}};function U(n){return!!n.data&&n.data[v]}var z=function(){for(var n=arguments.length,s=new Array(n),e=0;e<n;e++)s[e]=arguments[e];return function(n,r){if(0===n)for(var o=s.length,i=new Array(o),u=0,a=0,c=function(n){if(0!==n)for(var e=0;e<o;e++)i[e]&&i[e](n)},e=0;e<o;e++)(t=>{s[t](0,function(n,e){0===n?(i[t]=e,1==++u&&r(0,c)):2===n?(i[t]=void 0,++a===o&&r(2)):r(n,e)})})(e)}},Q=function(){return u(g(function(){return"complete"===document.readyState})(z(y(o),_(document,"readystatechange"))))},b=B(function(){return u(i(function(n){return n.data.origin=n.origin,n.data})(g(U)(_(window,"message"))))});function T(e){return function(n){return m(i(e)(n))}}var V=0,G=function(n,e,t,r){return void 0===r&&(r=V++),N(function(){return t.request=r,e(t),s(1)(T(function(n){var e,t;return n.data.error?(t=(e=n.data.result).real,e=e.error,t?(t=new Error(e.message),a("code",e)&&(t.code=e.code),w(t)):w(e)):y(function(){return n.data.result})})(g(function(n){return n.type===h&&n.request===r})(n)))})},H=function(n,o,i,u,e){return p({},n,{call:function(n){for(var e=arguments.length,t=new Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return c(G(o,u,i(f,{method:n,args:t})))},emit:function(n,e){u(i(l,{event:n,arg:e}))},data:e=void 0===e?null:e})},J=function(n,e,t,r){var o={};return o[v]=!0,o.owner=n,o.instance=e,o.type=t,o.data=r,o},K=function(r,o,i,u){return function(t){switch(t.type){case f:return void D(function(){var n=t.data,e=n.method;return u[e].apply(r,n.args)}).then(function(n){t.type=h,t.data={error:!1,result:n},i(t)},function(n){var e;t.type=h,n instanceof Error?(e={real:!0,error:{message:n.message}},a("code",n)&&(e.error.code=n.code)):e={real:!1,error:n},t.data={error:!0,result:e},i(t)});case l:var n=t.data,e=n.event;return void o(e,n.arg);default:return}}},X=function(n){return t=function(n){return"function"==typeof n},r=n,Object.keys(r).reduce(function(n,e){return n[t(r[e])?0:1][e]=r[e],n},[{},{}]);var t,r};function Z(l,n){void 0===l&&(l={});var n=(void 0===n?{}:n).handshakeTimeout,e=void 0===n?3e3:n,n=T(function(){return s(1)((a=e,(e=>function(n,t){var r,o,i;function u(n){i=setTimeout(function(){o(2);var n=new Error("Timeout.");n.code="TIMEOUT",t(2,n)},n)}0===n&&(r=a instanceof Date,e(0,function(n,e){0===n?(o=e,u(r?a-Date.now():a),t(0,function(n,e){2===n&&clearTimeout(i),o(n,e)})):(2===n?clearTimeout(i):1!==n||r||(clearTimeout(i),u(a)),t(n,e))}))})((o=50,(e=>function(n,t){var r;0===n&&e(0,function(n,e){if(1===n||2===n&&void 0===e){if(!r&&2===n)return t(n,e);r&&clearTimeout(r),r=setTimeout(function(){t(n,e),r=void 0},o)}else t(n,e)})})(g(function(n){return n.type===F})(b()))))));var o,a})(s(1)(Q()));return{promise:c(i(function(n){function e(n){a.postMessage(n,o)}var t=n.instance,r=n.owner,o=n.origin,i=X(l),u=i[0],i=i[1],a=window.parent,c=d(),s=g(function(n){return n.owner===r})(b()),f=H(c,s,function(n,e){return J(r,t,n,e)},e,n.data),c=K(f,c.emit,e,u);return W(c)(s),e(p({},n,{type:h,data:{error:!1,result:i}})),f})(n))}}var M=function(t){return Object.assign({},t,{trackEvent:function(n,e){if("string"!=typeof n||"object"!=typeof e)throw new Error("You have to specify the event name and its properties");return t.sendMessage("track",{event_name:n,event_properties:e})}})},$=["livechatinc.com","livechat.com","my.lc:3000","legacy.lc:3001"];function nn(){var e=function(n){};return window.addEventListener("message",function(n){(n=>{if(!n)return!1;try{var e=new URL(n),t=e.hostname.split("."),r=t.slice(t.length-2).join("."),o=e.port?r+":"+e.port:r;return $.includes(o)}catch(n){return!1}})(n.origin)&&e(n.data)}),{listen:function(n){e=n},send:function(n){return parent.postMessage(n,"*"),Promise.resolve()}}}function en(){var t=function(n){};return Z({handle:function(n){t(n)}}).promise.then(function(e){return{listen:function(n){t=n},send:function(n){return e.call("handle",n).then(function(){})}}})}function E(n){var e=location.search.replace(/^\?/,"").split("&").map(function(n){return n.split("=").map(decodeURIComponent)}).reduce(function(n,e){return n[e[0]]=e[1],n},{});return void 0!==e[n]?e[n]:null}var O,j,tn="plugin_id",rn="connection",C="livechat:";function on(t,r){var o=d();return t.listen(function(n){var e;n&&n.event_name&&(e=n.event_name.toString(),n=n.event_data,e.startsWith(C))&&o.emit(e.replace(C,""),n)}),{emitter:o,sendMessage:function(n,e){return t.send({plugin_id:r,message:n,data:e=void 0===e?null:e})}}}function S(){var e=E(tn);return("plain"===E(rn)?Promise.resolve(nn()):en()).then(function(n){return on(n,e)})}(R=O=O||{}).DirectCharge="direct_charge",R.RecurrentCharge="recurrent_charge",(R=j=j||{}).RegisterTransactionPending="register_transaction_pending",R.RegisterTransactionSuccess="register_transaction_success",R.RegisterTransactionFailure="register_transaction_failure";var un=function(n){return void 0!==n.months?O.RecurrentCharge:O.DirectCharge},an=function(n,e){var t=un(n),e={name:n.name,price:n.price,per_account:n.per_account,test:n.test,return_url:null,metadata:{type:t,isExternalTransaction:!0,icon:e.icon,description:e.description,showBillingCyclePicker:e.showBillingCyclePicker}};return t===O.RecurrentCharge?Object.assign({},e,{months:n.months,trial_days:n.trial_days}):Object.assign({},e,{quantity:n.quantity})},k=function(r){return Object.assign({},r,{startTransaction:function(n,e){try{if(!n)throw new Error("You have to provide charge details");if(!e||!e.icon)throw new Error("You have to provide metadata with icon");var t=an(n,e);r.sendMessage(j.RegisterTransactionPending,{paymentIntent:t}),r.sendMessage(j.RegisterTransactionSuccess,{charge:n})}catch(n){throw r.sendMessage(j.RegisterTransactionFailure,{error:n}),n}}})};function P(t,n){return Object.assign({},n,{on:t.emitter.on,off:t.emitter.off,sendMessage:function(n,e){return t.sendMessage(n,e=void 0===e?null:e)}})}var R,x=function(n){var e=null;return n.on("customer_profile",function(n){e=n}),Object.assign({},n,{getCustomerProfile:function(){return e}})},L=function(t){return Object.assign({},t,{sendQuickReplies:function(n,e){return t.sendMessage("send_quick_replies",{title:n,buttons:e})},sendCards:function(n){return t.sendMessage("send_cards",Array.isArray(n)?n:[n])}})},A=function(n){var e=new URLSearchParams(window.location.search).get("theme")||null;return n.on("change_theme",function(n){e=n.theme}),Object.assign({},n,{getTheme:function(){return e}})},cn=((R=e.SectionComponentType||(e.SectionComponentType={})).Button="button",R.LabelValue="label_value",R.Title="title",R.Link="link",R.Line="line",R.Customer="customer",R.Tags="tags",Object.keys(e.SectionComponentType).map(function(n){return e.SectionComponentType[n]})),sn=((R={})[e.SectionComponentType.Button]=function(n){n=n.data;if(!n||!n.label)throw new Error("The button component must have a 'label' property");if(!n.id)throw new Error("The button component must have a 'id' property")},R[e.SectionComponentType.Link]=function(n){n=n.data;if(!n||!n.url)throw new Error("The link component must have a 'url' property")},R[e.SectionComponentType.Title]=function(n){n=n.data;if(!n||!n.title)throw new Error("The title component must have a 'title' property");if(void 0!==n.imgSize&&!["big","small"].includes(n.imgSize))throw new Error("The title component must have a valid 'imgSize' property, allowed values are 'small' and 'big'")},R);function fn(n){if("object"!=typeof n)throw new Error("The component definition must be an object");var e=n.type;if("string"!=typeof e||!cn.includes(e))throw new Error("Invalid component type given: '"+e+"'");e=sn[e];e&&e(n)}function ln(r){var n=P(r,{putMessage:function(n){return r.sendMessage("put_message",n)},watchMessages:function(){return r.sendMessage("watch_messages")},refreshSession:function(){return r.sendMessage("plugin_loaded")},modifySection:function(n){if(!(t=n))throw new Error("You need to provide a section defintion");var e=t.title,t=t.components;if("string"!=typeof e||!e)throw new Error("You need to provide a title for the new section using the 'title' property");if(Array.isArray(t)&&t.length)return t.forEach(fn),r.sendMessage("customer_details_section",n);throw new Error("You need to provide an array of component definitions for your section using the 'components' property")}});return M(L(x(A(k(n)))))}var q=function(n){var e=null;return n.on("page_data",function(n){e=n}),Object.assign({},n,{getPageData:function(){return e}})};e.createDetailsWidget=function(){var e;return S().then(function(n){return e=ln(n),n.sendMessage("plugin_inited")}).then(function(){return e})},e.createFullscreenWidget=function(){var r;return S().then(function(n){var e,t;return t=P(e=n,{setNotificationBadge:function(n){return e.sendMessage("set_fullscreen_widget_notification_badge",n)},navigate:function(n){return e.sendMessage("navigate_from_fullscreen_widget",n)},setReportsFilters:function(n){return e.sendMessage("set_reports_filters",n)}}),r=M(q(A(k(t)))),n.sendMessage("plugin_inited")}).then(function(){return r})},e.createMessageBoxWidget=function(){var r;return S().then(function(n){var e,t;return t=P(e=n,{putMessage:function(n){n="string"==typeof n?{type:"message",value:n}:{type:"rich_message",payload:n};return e.sendMessage("put_messagebox_message",n)}}),r=M(L(x(A(k(t))))),n.sendMessage("plugin_inited")}).then(function(){return r})},e.createSettingsWidget=function(){var r;return S().then(function(n){var e,t;return t=P(e=n,{redirect:function(n){return e.sendMessage("redirect",n)}}),r=M(q(A(k(t)))),n.sendMessage("plugin_inited")}).then(function(){return r})},e.withCustomerProfile=x,Object.defineProperty(e,"__esModule",{value:!0})});
